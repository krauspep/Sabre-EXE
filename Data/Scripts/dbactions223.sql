CREATE GENERATOR PUPIL_PARENT_LINK_GEN;

CREATE TABLE PUPIL_PARENT_LINK
(
  PUPIL_PARENT_LINK_KEY DM_PRIMARY_KEY,
  PUPIL_KEY DM_KEY,
  PARENT_KEY DM_KEY,
  DELETED DM_BOOLEAN DEFAULT 0,
  ACTIVE_RECORD DM_ACTIVE DEFAULT 1,
  PRIMARY KEY (PUPIL_PARENT_LINK_KEY)
);

GRANT DELETE, INSERT, REFERENCES, SELECT, UPDATE ON PUPIL_PARENT_LINK TO SYSDBA WITH GRANT OPTION;

CREATE TRIGGER TR_PUPIL_PARENT_LINK FOR PUPIL_PARENT_LINK ACTIVE BEFORE INSERT POSITION 0
AS
begin
  if (new.PUPIL_PARENT_LINK_KEY is null)
  then begin
         new.PUPIL_PARENT_LINK_KEY = gen_id(PUPIL_PARENT_LINK_GEN, 1);
       end
end

ALTER TABLE CONTACT ADD PUPIL_PARENT_KEY DM_KEY_N1;




