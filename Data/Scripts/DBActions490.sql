RECREATE VIEW VW_EMPLOYEE_ATTENDANCE (
   EMPLOYEE_KEY, DEPARTMENT_KEY, D_USECUT, D_CUTOFF, D_N_USECUT, D_N_CUTOFF, ATTENDANCE_KEY, ATTENDANCE_DATE, 
   ATTENDANCE_TIME, MANUAL_FIX, EVENT_KEY, RECORD_STATUS, IS_PH, DEVICE_LOCATION, 
   CALC_CLOCK_IN, CALC_CLOCK_OUT
) AS	
SELECT E.EMPLOYEE_KEY,
       D.DEPARTMENT_KEY, 
       D.USE_CUT_OFF_TIME               AS D_USECUT, 
       D.CUT_OFF_TIME                   AS D_CUTOFF, 
       D.USE_NIGHT_SHIFT_CUT_OFF_TIME   AS D_N_USECUT, 
       D.NIGHT_SHIFT_CUT_OFF_TIME       AS D_N_CUTOFF, 
	   A.ATTENDANCE_KEY,
       A.ATTENDANCE_DATE, 
       A.ATTENDANCE_TIME,
       A.MANUAL_FIX,
       A.EVENT_KEY,
       A.RECORD_STATUS,
       CASE A.RECORD_STATUS WHEN 'PH' THEN 1 ELSE 0 END AS IS_PH,
       DL.DEVICE_LOCATION,
       CASE EVENT_KEY WHEN 1 THEN CAST( A.ATTENDANCE_DATE || ' ' || A.ATTENDANCE_TIME as timestamp ) WHEN 2 THEN NULL END AS CALC_CLOCK_IN,
       CASE EVENT_KEY WHEN 1 THEN NULL WHEN 2 THEN CAST( A.ATTENDANCE_DATE || ' ' || A.ATTENDANCE_TIME as timestamp ) END AS CALC_CLOCK_OUT
  FROM EMPLOYEE E 
       JOIN ATTENDANCE A            ON A.EMPLOYEE_KEY = E.EMPLOYEE_KEY
       LEFT JOIN DEVICE_LOCATION DL ON DL.DEVICE_LOCATION_KEY = A.DEVICE_LOCATION_KEY
       LEFT JOIN DEPARTMENT D       ON D.DEPARTMENT_KEY = E.DEPARTMENT_KEY
 WHERE A.ACTIVE_RECORD = 1
   AND A.DELETED       = 0;   