ALTER TABLE PUPIL_PARENT ADD PARENT_NO DM_INTEGER;

ALTER TABLE PUPIL_PARENT ADD PUPIL_KEY DM_KEY;

ALTER TABLE PUPIL_PARENT ADD ENROLL_ID DM_INTEGER;

ALTER TABLE PUPIL_PARENT ADD DEVICE_ID_NAME DM_DEVICE_ID_NAME;

ALTER TABLE PUPIL_PARENT ADD DEVICE_PASSWORD DM_PASSWORD;

ALTER TABLE PUPIL_PARENT ADD DEVICE_PRIVLAGE_KEY DM_KEY;

ALTER TABLE PUPIL_PARENT ADD ENABLED_ON_DEVICE DM_BOOLEAN DEFAULT  0;

ALTER TABLE PUPIL_PARENT ADD EVENT_STATUS DM_SHORT_NAME;

ALTER TABLE PUPIL_PARENT ADD TRACK DM_BOOLEAN DEFAULT  0;

ALTER TABLE PUPIL_PARENT ADD LAST_EVENT_DATE DM_DATE;

ALTER TABLE PUPIL_PARENT ADD LAST_EVENT_TIME DM_TIME;

ALTER TABLE PUPIL_PARENT ADD LEFT_THUMB DM_BOOLEAN DEFAULT 0;

ALTER TABLE PUPIL_PARENT ADD LEFT_INDEX DM_BOOLEAN DEFAULT 0;

ALTER TABLE PUPIL_PARENT ADD LEFT_MIDDLE DM_BOOLEAN DEFAULT 0;

ALTER TABLE PUPIL_PARENT ADD LEFT_RING DM_BOOLEAN DEFAULT 0;

ALTER TABLE PUPIL_PARENT ADD LEFT_SMALL DM_BOOLEAN DEFAULT 0;

ALTER TABLE PUPIL_PARENT ADD RIGHT_THUMB DM_BOOLEAN DEFAULT 0;

ALTER TABLE PUPIL_PARENT ADD RIGHT_INDEX DM_BOOLEAN DEFAULT 0;

ALTER TABLE PUPIL_PARENT ADD RIGHT_MIDDLE DM_BOOLEAN DEFAULT 0;

ALTER TABLE PUPIL_PARENT ADD RIGHT_RING DM_BOOLEAN DEFAULT 0;

ALTER TABLE PUPIL_PARENT ADD RIGHT_SMALL DM_BOOLEAN DEFAULT 0;

ALTER TABLE ATTENDANCE ADD PUPIL_PARENT_KEY DM_KEY_N1;

ALTER TABLE ATTENDANCE_ARCHIVE ADD PUPIL_PARENT_KEY DM_KEY_N1;

ALTER TABLE PUPIL_PARENT ADD TITLE_KEY DM_KEY;

ALTER TABLE PUPIL_PARENT ADD COMPANY_KEY DM_KEY;

CREATE GENERATOR PUPIL_PARENT_DEVICE_LINK_GEN;

CREATE GENERATOR PUPIL_PARENT_TIME_ZONE_GEN;

CREATE TABLE PUPIL_PARENT_DEVICE_LINK
(
  PUPIL_PARENT_DEVICE_LINK_KEY DM_PRIMARY_KEY,
  PUPIL_PARENT_KEY DM_KEY,
  DEVICE_KEY DM_KEY,
  ENABLED_ON_DEVICE DM_BOOLEAN DEFAULT 0,
  DELETED DM_BOOLEAN DEFAULT 0,
  OPEN_DOOR DM_BOOLEAN DEFAULT 0,
  DEVICE_TYPE_KEY DM_KEY,
  IS_SELECTED DM_FALSE DEFAULT 'F',
  ENROLL_GROUP DM_SMALLINT,
  ACTIVE_RECORD DM_ACTIVE DEFAULT 1,
  PRIMARY KEY (PUPIL_PARENT_DEVICE_LINK_KEY)
);

GRANT DELETE, INSERT, REFERENCES, SELECT, UPDATE ON PUPIL_PARENT_DEVICE_LINK TO SYSDBA WITH GRANT OPTION;

CREATE TRIGGER TR_PUPIL_PARENT_DEVICE_LINK FOR PUPIL_PARENT_DEVICE_LINK ACTIVE BEFORE INSERT POSITION 0
AS
begin
  if (new.PUPIL_PARENT_DEVICE_LINK_KEY is null)
  then begin
         new.PUPIL_PARENT_DEVICE_LINK_KEY = gen_id(PUPIL_PARENT_DEVICE_LINK_GEN, 1);
       end
end


CREATE TABLE PUPIL_PARENT_TIME_ZONE
(
  PUPIL_PARENT_TIME_ZONE_KEY DM_PRIMARY_KEY,
  PUPIL_PARENT_KEY DM_KEY,
  DEVICE_CONFIGURATION_KEY DM_KEY,
  TIME_ZONE1 DM_SMALLINT,
  TIME_ZONE2 DM_SMALLINT,
  TIME_ZONE3 DM_SMALLINT,
  DELETED DM_BOOLEAN DEFAULT 0,
  ACTIVE_RECORD DM_ACTIVE DEFAULT 1,
  PRIMARY KEY (PUPIL_PARENT_TIME_ZONE_KEY)
);

GRANT DELETE, INSERT, REFERENCES, SELECT, UPDATE ON PUPIL_PARENT_TIME_ZONE TO SYSDBA WITH GRANT OPTION;

CREATE TRIGGER TR_PUPIL_PARENT_TIME_ZONE FOR PUPIL_PARENT_TIME_ZONE ACTIVE BEFORE INSERT POSITION 0
AS
begin
  if (new.PUPIL_PARENT_TIME_ZONE_KEY is null)
  then begin
         new.PUPIL_PARENT_TIME_ZONE_KEY = gen_id(PUPIL_PARENT_TIME_ZONE_GEN, 1);
       end
end



