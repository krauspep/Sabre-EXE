ALTER TABLE DEVICE_CONFIGURATION ALTER DEVICE_IP TYPE VARCHAR(15);

UPDATE DEVICE_CONFIGURATION SET DEVICE_IP = TRIM( DEVICE_IP );

ALTER TABLE COMPANY ADD DEVICE_PASSWORD INT  DEFAULT 0 NOT NULL;

UPDATE COMPANY SET DEVICE_PASSWORD = '532000';


ALTER TABLE SHIFT ADD 
INCLUDE_IN_SHIFT_SENSING DM_BOOLEAN DEFAULT 1;

UPDATE SHIFT
SET INCLUDE_IN_SHIFT_SENSING = 1
WHERE INCLUDE_IN_SHIFT_SENSING IS NULL;

ALTER TABLE EMPLOYEE ADD 
ABSENT_HOURS_USE DM_BOOLEAN DEFAULT 1;

UPDATE EMPLOYEE
SET ABSENT_HOURS_USE = 1
WHERE ABSENT_HOURS_USE IS NULL;

ALTER TABLE EMPLOYEE ADD 
ABSENT_HOURS_HRS DM_INTEGER DEFAULT 8;

UPDATE EMPLOYEE
SET ABSENT_HOURS_HRS = 8
WHERE ABSENT_HOURS_HRS IS NULL;

ALTER TABLE EMPLOYEE ADD 
ABSENT_HOURS_MINS DM_INTEGER DEFAULT 0;

UPDATE EMPLOYEE
SET ABSENT_HOURS_MINS = 0
WHERE ABSENT_HOURS_MINS IS NULL;

ALTER TABLE ABSENT_DATA ADD 
INCLUDE_PPH DM_BOOLEAN NOT NULL;

UPDATE ABSENT_DATA 
SET INCLUDE_PPH = '0' 
WHERE INCLUDE_PPH IS NULL;

CREATE GENERATOR ABSENT_DATA_DAYS_GEN;

SET GENERATOR ABSENT_DATA_DAYS_GEN TO 0;

CREATE TABLE ABSENT_DATA_DAYS
(
  ABSENT_DATA_DAYS_KEY DM_KEY,
  ABSENT_DATA_KEY DM_KEY,
  DATE_TAKEN DM_DATE,
  TO_DATE DM_DATE,
  DELETED DM_BOOLEAN DEFAULT 0,
  ACTIVE_RECORD DM_ACTIVE DEFAULT 1,
  FROM_TIME DM_TIME,
  TO_TIME DM_TIME,
  BREAK_MINUTES DM_INTEGER,
  ABSENT_MINUTES DM_INTEGER,
  MINUTES_WORKED DM_INTEGER,
  SHIFT_KEY DM_KEY,
  DAYS_TAKEN DM_FLOAT,
  OVERRIDE DM_BOOLEAN DEFAULT 0,
  CONSTRAINT INTEGER_1 PRIMARY KEY (ABSENT_DATA_DAYS_KEY)
);

GRANT DELETE, INSERT, REFERENCES, SELECT, UPDATE
 ON ABSENT_DATA_DAYS TO  SYSDBA WITH GRANT OPTION;

CREATE TRIGGER TR_ABSENT_DATA_DAYS FOR ABSENT_DATA_DAYS ACTIVE
BEFORE INSERT POSITION 0
AS
begin
  if (new.ABSENT_DATA_DAYS_KEY is null)
  then begin
         new.ABSENT_DATA_DAYS_KEY = gen_id(ABSENT_DATA_DAYS_GEN, 1);
       end
end

CREATE TRIGGER TR_ABSENT_DATA_DAYS_VALUES FOR ABSENT_DATA_DAYS ACTIVE
BEFORE INSERT POSITION 0
AS
begin
 new.DELETED = 0;
 new.ACTIVE_RECORD = 1;
end
